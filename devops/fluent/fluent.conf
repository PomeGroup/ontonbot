<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<filter docker.**>
  @type concat
  key log
  multiline_start_regexp /^\[START\]/
  multiline_end_regexp /^\[END\]/
  separator "\n"
  flush_interval 5s
  timeout_label @CONCAT_ERROR
</filter>

<match docker.**>
  @type elasticsearch
  host elasticsearch
  port 9200
  scheme http
  logstash_format true
  include_tag_key true
  logstash_prefix docker
  @log_level debug
  log_es_400_reason true
  bulk_message_request_threshold 5m
  with_transporter_log true
  tag_key @tag
  verify_es_version_at_startup false
  suppress_type_name true
  time_key @timestamp
  time_key_format %Y-%m-%dT%H:%M:%S.%NZ
  include_timestamp true
  reconnect_on_error true
  reload_on_failure true
  reload_connections false
  chunk_limit_size 64m
  <buffer tag,time>
    @type file
    path /fluentd/log/buffer
    timekey 60
    timekey_wait 10s
    timekey_use_utc true
    flush_mode interval
    flush_interval 5s
    retry_forever true
    retry_max_times 15
    chunk_limit_size 64m
  </buffer>
</match>

<label @CONCAT_ERROR>
  <match **>
    @type stdout
    @log_level error
  </match>
</label>
