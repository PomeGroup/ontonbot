name: Check Changes

on:
  workflow_call:
    inputs:
      dir:
        required: true
        type: string
    outputs:
      run_job:
        description: "Whether the job should run or not"
        value: ${{ jobs.outputs.run_job }}

jobs:
  check:
    runs-on: ubuntu-latest
    outputs:
      run_job: ${{ steps.check.outputs.run_job }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          fetch-depth: 2

      - name: Check modified files
        id: check
        run: |
          echo "=============== list modified files ==============="
          git diff --name-only HEAD^ HEAD
          
          echo "========== check paths of modified files =========="
          git diff --name-only HEAD^ HEAD > files.txt
          run_job=false
          while IFS= read -r file
          do
            echo $file
            if [[ $file == ${{ inputs.dir }}/* ]]; then
              run_job=true
              break
            fi
          done < files.txt
          echo "run_job=$run_job" >> "$GITHUB_OUTPUT"

